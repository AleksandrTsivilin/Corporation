
<!-- <div
    class="absolute  h-screen  w-full  bg-green-300 -bottom-28 right-12 z-40"
    *ngIf="isShowModalWarning"    
>
    <app-warning-modal [modalInfo]="modalInfo"></app-warning-modal>

</div> -->

<!-- <div
    class="flex absolute h-screen w-full inset-y-auto  bg-green-500  z-40"
    *ngIf="isShowModalWarning"    
>
    <app-warning-modal [modalInfo]="modalInfo"></app-warning-modal>

</div> -->
<app-warning-modal 
    *ngIf="isShowModalWarning" 
    [modalInfo]="modalInfo"
    (answer)="closeModalWarning($event)"
></app-warning-modal>
<div 
    class="w-full "
>   
    
    <form 
        class="w-full space-y-4"
        #filterForm="ngForm"
    >
        <div class="flex gap-x-4">
            <div class="flex-1 w-1/3">
                <div class=" pl-2 relative">
                    <span class="pr-2 my-auto font-medium">regions</span>
                    <button 
                        class="absolute w-3 h-3 mt-2 p-1"
                        *ngIf="isSelectedSomething(rawFilterForm.regionId)"
                        type="button"
                        (click)="resetSelectedRegion()"
                    >
                        <span class="animation-btn"></span>
                    </button>                                     
                </div>
                <section *ngIf="loadingOptionFilterByCriteria.isComplitedLoadingRegions else loadingOption">
                    <select 
                        class="appearance-none rounded-md w-full mt-1"
                        *ngIf="regions.length>1 else showRegionTitle"                    
                        [(ngModel)]=rawFilterForm.regionId
                        name="regions"
                        (change)="changeFilterRegion()"
                    >
                        <option
                            class=" text-xs font-ligth text-gray-700"
                            *ngFor="let region of regions" 
                            [value]="region.id"
                            name="region"                   
                        >
                            {{region.title}}
                        </option>
                    </select>
                </section>
                
            </div>
            <div class="flex-1 w-1/3">
                <div class=" pl-2 relative">
                    <span class="pr-2 my-auto font-medium">factories</span>
                    <button 
                        class="absolute w-3 h-3 mt-2 p-1"
                        *ngIf="isSelectedSomething(rawFilterForm.factoryId)"
                        type="button"
                        (click)="resetSelectedFactory()"
                    >
                        <span class="animation-btn"></span>
                    </button>
                </div>
                <section *ngIf="loadingOptionFilterByCriteria.isCompliteLoadingFactories else loadingOption">
                    <select                         
                        class="appearance-none rounded-md w-full mt-1"
                        *ngIf="factories.length>1 else showFactoryTitle"
                        [(ngModel)]=rawFilterForm.factoryId
                        name="factories"
                        (change)="changeFilterFactory()"              
                        
                    >
                        <option class="hidden" [value]="0"  disabled></option>
                        <option
                            class="appearance-none text-xs font-ligth text-grey-700"
                            *ngFor="let factory of factories" 
                            
                            [value]="factory.id"                  
                            name="factory" 

                        >
                            {{factory.title}}
                        </option>
                    </select>
                </section>
                
                
            </div>
            <div class="flex-1 w-1/3">
                <div class=" pl-2 relative">
                    <span class="pr-2 my-auto font-medium">storages</span>
                    <button 
                        class="absolute w-3 h-3 mt-2 p-1"
                        *ngIf="isSelectedSomething(rawFilterForm.storageId)"
                        type="button"
                        (click)="resetSelectedStorage()"
                    >
                        <span class="animation-btn"></span>
                    </button>
                </div>
                <section *ngIf="loadingOptionFilterByCriteria.isComplitedLoadingStorages else loadingOption">
                    <select 
                        class="appearance-none rounded-md w-full mt-1"
                        *ngIf="storages.length>1 else showStorageTitle"
                        [(ngModel)]=rawFilterForm.storageId
                        name="storages"
                    >
                        <option class="hidden" [value]="0"  disabled></option>
                        <option
                            class="appearance-none text-xs font-ligth text-grey-700"
                            *ngFor="let storage of storages" 
                            [value]="storage.id"
                            name="storage"                   
                        >
                            {{storage.title}}
                        </option>
                    </select>
                </section>
                
            </div>
        </div>
        <div class="flex gap-x-4">
            <div class="flex-1 w-1/3">
                <div class=" pl-2 relative">
                    <span class="pr-2 my-auto font-medium">manufacturers</span>
                    <button 
                        class="absolute w-3 h-3 mt-2 p-1"
                        *ngIf="isSelectedSomething(rawFilterForm.manufacturerId)"
                        type="button"
                        (click)="resetSelectedManufacturer()"
                    >
                        <span class="animation-btn"></span>
                    </button>
                </div>
                <section *ngIf="loadingOptionFilterByCriteria.isComplitedLoadingManufacturers else loadingOption">
                    <select 
                        class="appearance-none rounded-md w-full mt-1"
                        [(ngModel)]=rawFilterForm.manufacturerId
                        name="manufacturers"
                        
                    >
                        <option
                            class="appearance-none text-xs font-ligth text-gray-700"
                            *ngFor="let manufacturer of manufacturers" 
                            [value]="manufacturer.id"
                            name="manufacturer"                   
                        >
                            {{manufacturer.title}}
                        </option>
                    </select>
                </section>
            </div>
            <div class="flex-1 w-1/3">
                <div class=" pl-2 relative">
                    <span class="pr-2 my-auto font-medium">categories</span>
                    <button 
                        class="absolute w-3 h-3 mt-2 p-1"
                        *ngIf="isSelectedSomething(rawFilterForm.categoryId)"
                        type="button"
                        (click)="resetSelectedCategory()"
                    >
                        <span class="animation-btn"></span>
                    </button>
                </div>
                <section *ngIf="loadingOptionFilterByCriteria.isComplitedLoadingCategories else loadingOption">   
                    <select 
                        class="appearance-none rounded-md w-full mt-1"
                        [(ngModel)]=rawFilterForm.categoryId
                        name="categories"
                        
                    >
                        <option
                            class="appearance-none text-xs font-ligth text-gray-700"
                            *ngFor="let category of categories" 
                            [value]="category.id"
                            name="category"                   
                        >
                            {{category.title}}
                        </option>
                    </select>
                </section>
            </div>
            <div class="flex-1 w-1/3">
                <div class=" pl-2 relative">
                    <span class="pr-2 my-auto font-medium">units</span>
                    <button 
                        class="absolute w-3 h-3 mt-2 p-1"
                        *ngIf="isSelectedSomething(rawFilterForm.unitId)"
                        type="button"
                        (click)="resetSelectedUnit()"
                    >
                        <span class="animation-btn"></span>
                    </button>
                </div>
                <section *ngIf="loadingOptionFilterByCriteria.isComplitedLoadingUnits else loadingOption">
                    <select 
                        class="appearance-none rounded-md w-full mt-1"
                        [(ngModel)]=rawFilterForm.unitId
                        name="unit"
                        
                    >
                        <option
                            class="appearance-none text-xs font-ligth text-gray-700"
                            *ngFor="let unit of units" 
                            [value]="unit.id"
                            name="unit"                   
                        >
                            {{unit.title}}
                        </option>
                    </select>
                </section>
            </div>
        </div>
        <div class="flex gap-x-4 juctify-center">
            <div class="flex-1 w-1/3 juctify-center space-y-4 border-2 border-gray-400 rounded-md filter-price-active">
                <div class=" px-2 relative">
                    <span class="pr-2 my-auto font-medium">count</span>
                    <button 
                        class="absolute w-3 h-3 mt-2 p-1"
                        *ngIf="isSelectedRangeCount()"
                        type="button"
                        (click)="resetSelectedRangeCount()"
                    >
                        <span class="animation-btn"></span>
                    </button>
                    <div class="flex justify-between custom-control custom-radio">
                        <div>
                            <input
                                class="custom-control-input"
                                type="radio"
                                name="A"
                                [(ngModel)]="stepRangeCount"
                                [value]="1"
                            >
                            <span class="pl-2">+1</span>
                        </div>
                        <div>
                            <input
                                class="custom-control-input"
                                type="radio"
                                name="B"
                                [(ngModel)]="stepRangeCount"
                                [value]="10"
                            >
                            <span class="pl-2">+10</span>
                        </div>
                        <div>
                            <input
                                class="custom-control-input"
                                type="radio"
                                name="C"
                                [(ngModel)]="stepRangeCount"
                                [value]="100"
                            >
                            <span class="pl-2">+100</span>
                        </div>
                        
                    </div>
                </div>
            <div class="flex-col px-2">
                <div class="flex py-2">
                <div class="flex-none w-1/4 my-auto">
                    <span >start : </span>
                </div>
                <div class="flex-none w-1/2 flex justify-items-center">
                    <input
                    class="w-full"
                    type="range"
                    min="0"
                    max="{{filterMaxCount-1}}"
                    step="{{stepRangeCount}}"
                    [(ngModel)]="rawFilterForm.startCount"
                    name="startCount"
                    (ngModelChange)="changeFilterStartCount($event)"
                    >
                </div>
                <div class="flex-none w-1/4 pl-2">
                    <span>{{rawFilterForm.startCount}}</span>
                </div>
                
                </div>
                <div class="flex py-2">
                <div class="flex-none w-1/4 my-auto">
                    <span >end : </span>
                </div>
                <div class="flex-none w-1/2 flex justify-items-center">
                    <input
                    class="w-full"
                    type="range"
                    min="0"
                    max="{{filterMaxCount}}"
                    step="{{stepRangeCount}}"
                    [(ngModel)]="rawFilterForm.endCount"
                    name="endCount"
                    (ngModelChange)="changeFilterEndCount($event)"
                    >
                </div>
                <div class="flex-none w-1/4 pl-2">
                    <span>{{rawFilterForm.endCount}}</span>
                </div>
                
                </div>
                
            </div>
            </div>
            <div class="flex-1 w-1/3 juctify-center space-y-4 border-2 border-gray-400 rounded-md filter-price-active">
                <div class=" px-2 relative">
                    <span class="pr-2 my-auto font-medium">price</span>
                    <button 
                        class="absolute w-3 h-3 mt-2 p-1"
                        *ngIf="isSelectedRangePrice()"
                        type="button"
                        (click)="resetSelectedRangePrice()"
                    >
                        <span class="animation-btn"></span>
                    </button>
                    <div class="flex justify-between custom-control custom-radio">
                        <div>
                            <input
                                class="custom-control-input"
                                type="radio"
                                name="D"
                                [(ngModel)]="stepRangePrice"
                                [value]="50"
                            >
                            <span class="pl-2">+50</span>
                        </div>
                        <div>
                            <input
                                class="custom-control-input"
                                type="radio"
                                name="E"
                                [(ngModel)]="stepRangePrice"
                                [value]="500"
                            >
                            <span class="pl-2">+500</span>
                        </div>
                        <div>
                            <input
                                class="custom-control-input"
                                type="radio"
                                name="F"
                                [(ngModel)]="stepRangePrice"
                                [value]="5000"
                            >
                            <span class="pl-2">+5000</span>
                        </div>
                        
                    </div>
                </div>
            <div class="flex-col px-2">
                <div class="flex py-2">
                <div class="flex-none w-1/4 my-auto">
                    <span >start : </span>
                </div>
                <div class="flex-none w-1/2 flex justify-items-center">
                    <input
                    class="w-full"
                    type="range"
                    min="0"
                    max="{{filterMaxPrice-1}}"
                    step="{{stepRangePrice}}"
                    [(ngModel)]="rawFilterForm.startPrice"
                    name="startPrice"
                    (ngModelChange)="changeFilterStartPrice($event)"
                    >
                </div>
                <div class="flex-none w-1/4 pl-2">
                    <span>{{rawFilterForm.startPrice}}</span>
                </div>
                
                </div>
                <div class="flex py-2">
                <div class="flex-none w-1/4 my-auto">
                    <span >end : </span>
                </div>
                <div class="flex-none w-1/2 flex justify-items-center">
                    <input
                    class="w-full"
                    type="range"
                    min="0"
                    max="{{filterMaxPrice}}"
                    step="{{stepRangePrice}}"
                    [(ngModel)]="rawFilterForm.endPrice"
                    name="endPrice"
                    (ngModelChange)="changeFilterEndPrice($event)"
                    >
                </div>
                <div class="flex-none w-1/4 pl-2">
                    <span>{{rawFilterForm.endPrice}}</span>
                </div>
                
                </div>
                
            </div>
            
            
            </div>
            <div class="flex-1 w-1/3">            
            </div>
        </div>
        <div class="flex justify-around">
            <div>
            <button 
                [ngClass]="isEmptyForm() ? 'btn-non-active' : 'btn-active'"
                (click)="onSubmitFilter()"
                type="button"
                [disabled]=isEmptyForm()
            >
                apply
            </button>
            </div>
            <div>
            <button
                class="btn-active"
                (click)="clearFilterForm()"
                type="button"
            >
                clear
            </button>
            </div>
            <div>
            <button
                [ngClass]="isEmptyForm() ? 'btn-non-active' : 'btn-active'"
                (click)="onSubmitFilterWithSave()"
                type="button"
                [disabled]=isEmptyForm()
            >
                apply and save
            </button>
            </div>
        </div>
    </form>
</div>

<!-- <div class="absolute  w-full h-screen bg-green-500 ">
    <app-warning-modal
        
        *ngIf="isShowModalWarning"
        [modalInfo]="modalInfo"

    ></app-warning-modal>  
</div> -->

         
        
<ng-template #showRegionTitle>
    <div *ngFor="let region of regions" class="cell-option">{{region.title}}</div>
    
</ng-template>

<ng-template #showFactoryTitle>
    <div *ngFor="let factory of factories" class="cell-option">{{factory.title}}</div>
</ng-template>

<ng-template #showStorageTitle>
    <div *ngFor="let storage of storages" class="cell-option">{{storage.title}}</div>
</ng-template>

<ng-template #loadingOption>
    <div 
        class="cell-option-non-active"
    >
        <span class="flex w-3 h-3 my-auto  rounded-full border-b-2 border-green-500 animate-spin"></span>
    </div>
</ng-template>





